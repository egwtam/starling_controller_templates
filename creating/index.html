<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>4. Creating your own Starling project - Starling Tutorial</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet"/>
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "4. Creating your own Starling project";
    var mkdocs_page_input_path = "creating.md";
    var mkdocs_page_url = null;
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Starling Tutorial</a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/">1. Getting Started </a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_uav/">2. ROS2 and UAV Control</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docker/">3. Docker and Containerisation</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="./">4. Creating your own Starling project</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#prerequists">4.1 Prerequists</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#project-structure-planning">4.2 Project Structure Planning</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generating-the-base-starling-project">4.3 Generating the base Starling Project</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-nodes-to-your-project">4.4 Adding Nodes to your project</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-in-the-templates">4.5 What is in the templates</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#cpp_ros2_node_onboard_template">4.5.1 cpp_ros2_node_onboard_template</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#python_ros2_node_offboard_template">4.5.2 python_ros2_node_offboard_template</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ros2_msgs_template">4.5.3 ros2_msgs_template</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dockerfile">4.5.4 Dockerfile</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-your-new-project">4.6 Running your new project</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#initialising-git">4.7 Initialising Git</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">4.8 Next Steps</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulation/">5. Simulation and the Digital Double</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cpp_example_dev/">6. Developing the example controller with ROS2 in CPP</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing_with_docker_compose/">7. Local testing with Docker-Compose</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../multiuav_kubernetes/">8. Multi-UAV flight with Kubernetes for container deployment</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing_with_kind/">9. Local Integration testing with KinD Digital Double</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../brl/">10. Bristol Robotics Laboratory Flying Arena</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../brl_flight/">11. Flying your controllers in the Flying Arena</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../next_steps/">12. Wrapping up and next steps</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Starling Tutorial</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>Tutorial »</li>
<li>4. Creating your own Starling project</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/StarlingUAS/starling_controller_templates/tree/implement_example/edit/master/docs/creating.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="creating-your-own-starling-project"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.</span> Creating your own Starling Project<a class="headerlink" href="#creating-your-own-starling-project" title="Permanent link">¶</a></h1>
<p>This tutorial takes you through using the Starling templates repository to generate your own custom starling application.</p>
<div class="toc">
<ul>
<li><a href="#creating-your-own-starling-project">4. Creating your own Starling Project</a><ul>
<li><a href="#prerequists">4.1 Prerequists</a></li>
<li><a href="#project-structure-planning">4.2 Project Structure Planning</a></li>
<li><a href="#generating-the-base-starling-project">4.3 Generating the base Starling Project</a></li>
<li><a href="#adding-nodes-to-your-project">4.4 Adding Nodes to your project</a></li>
<li><a href="#what-is-in-the-templates">4.5 What is in the templates</a><ul>
<li><a href="#cpp_ros2_node_onboard_template">4.5.1 cpp_ros2_node_onboard_template</a></li>
<li><a href="#python_ros2_node_offboard_template">4.5.2 python_ros2_node_offboard_template</a></li>
<li><a href="#ros2_msgs_template">4.5.3 ros2_msgs_template</a></li>
<li><a href="#dockerfile">4.5.4 Dockerfile</a></li>
</ul>
</li>
<li><a href="#running-your-new-project">4.6 Running your new project</a></li>
<li><a href="#initialising-git">4.7 Initialising Git</a></li>
<li><a href="#next-steps">4.8 Next Steps</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="prerequists"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.1</span> Prerequists<a class="headerlink" href="#prerequists" title="Permanent link">¶</a></h2>
<p>In order to complete this tutorial, you will need the following installed. You may have already installed these within <a href="../getting_started/">Getting Strted</a></p>
<p>The template generation uses the <a href="https://cookiecutter.readthedocs.io/en/stable/README.html"><code>cookiecutter</code></a> tool for generating custom projects from a template.</p>
<p>Then run:</p>
<pre><code class="language-sh">python3 -m pip install --user cookiecutter
# or
easy_install --user cookiecutter
</code></pre>
<blockquote>
<p>See <a href="https://cookiecutter.readthedocs.io/en/stable/installation.html">cookiecutter installation</a> for further details on different platforms.</p>
</blockquote>
<p>This will give you access to the <code>cookiecutter</code> command line interface.</p>
<blockquote>
<p>Recommendation is to sign up for Docker Hub and Github, necessary if you wish to fly your controller in the real world.</p>
</blockquote>
<h2 id="project-structure-planning"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.2</span> Project Structure Planning<a class="headerlink" href="#project-structure-planning" title="Permanent link">¶</a></h2>
<p>Before diving in to creating your project, you first need to decide on the structure of the project. The structure is wholy determined by the application, and the functionality that is split between the central server and onboard each vehicle. Let's review our task for this tutorial:</p>
<blockquote>
<blockquote>
<p>In this scene a number of drones take off and automatically fly to starting points equidistant around a circle of a given radius. They then start circling around the edge of the circle attempting to stay equidistant to their neighbours. It is determined that the vehicles have not been well tuned and can end up lagging, therefore a centralised server monitors all the vehicles and notifies them if they are lagging behind.</p>
</blockquote>
</blockquote>
<p>A Starling Project is comprised of one or more ROS Nodes which each encompass one piece of functionality. In this project we can identify the need for the following:</p>
<ol>
<li>A node onboard the vehicle which can arm, takeoff, land and fly it in a circle of radius r from a given start location in a safe manner.</li>
<li>A node offboard on the cetral server which receives vehicle locations, finds the ideal locations and then sends that information back to the vehicles.</li>
</ol>
<p>Through this we identify that we may also need to provide a set of custom messages for the communication of specific information between server and vehicle.</p>
<p>Therefore this Starling Project will contain the source code for an onboard node, an offboard node and a set of custom messages.</p>
<p>An important task is then to name these beforehand as we will need to refer to these names in the next step. By default we have named them the following, but you should endeavour to name them something better!</p>
<ol>
<li>Offboard node: <code>template_python_node</code></li>
<li>Onboard node: <code>template_cpp_node</code></li>
<li>Custom msgs: <code>template_msgs</code></li>
</ol>
<h2 id="generating-the-base-starling-project"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.3</span> Generating the base Starling Project<a class="headerlink" href="#generating-the-base-starling-project" title="Permanent link">¶</a></h2>
<p>The first step is to build your own Starling project. The following will start the process of using the template to generate the base starling project. In your workspace, run the following command.</p>
<pre><code class="language-bash">cookiecutter https://github.com/StarlingUAS/starling_controller_templates.git --directory starling_template
</code></pre>
<p>It will follow by asking you to fill in a number of details. The value in the square brackets indicates the default value if you choose not to enter anything. Press Enter to go on to the next one. The inputs include the following.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Full Name</td>
<td>Your name used for documentaiton</td>
</tr>
<tr>
<td>Email</td>
<td>Your email address used for documentation</td>
</tr>
<tr>
<td>Short Description</td>
<td>A short description of your project added to the documentation and project files</td>
</tr>
<tr>
<td>Project Name</td>
<td>The name you have given to this Starling Project, make sure that you are happy with this as changing the name after fact is a bit of a pain.</td>
</tr>
<tr>
<td>Github Username</td>
<td>Optionally your github username for filling in the README and metadata</td>
</tr>
<tr>
<td>Docker Username</td>
<td>Optionally your docker hub username which is used for naming the Starling image. Will be used to upload to if you wish to push it online.</td>
</tr>
<tr>
<td>Docker Image Name</td>
<td>The name of the Starling image that this repository produces</td>
</tr>
<tr>
<td>Docker Image Name Full</td>
<td>An autogenerated name based on your username and image name, you can leave as the default unless you really want to change it. By default it is <code>&lt;Docker Username&gt;/&lt;Docker Image Name&gt;</code></td>
</tr>
<tr>
<td>Onboard ROS2 Package Name</td>
<td>The name of the onboard controller which this containers Dockerfile will run in <code>onboard</code> mode.</td>
</tr>
<tr>
<td>Offboard ROS2 Package Name</td>
<td>The name of the offboard controller which this containers Dockerfile will run in <code>offboard</code> mode.</td>
</tr>
</tbody>
</table>
<blockquote>
<p><em>Note:</em> The last two entries should correspond to the node names you came up with in the planning phase.</p>
<p><em>Note:</em> The last two entries are for automatically populating the <code>run.sh</code> script. The <code>run.sh</code> script is the default script your project's Docker container runs on startup. You can leave these two as defaults and edit the <code>run.sh</code> script later.</p>
</blockquote>
<p>Once complete, the project will be generated into a folder named by your <code>project_name</code>. For example, the default project with name <code>starling_controller</code> produces a project with the following structure:</p>
<pre><code class="language-tree">starling_controller
|-- buildtools
    |-- docker-bake.hcl
|-- deployment
    |-- docker-compose.yml
    |-- kubernetes.yaml
|-- starling_controller
    |-- run.sh
|-- Dockerfile
|-- LICENSE
|-- Makefile
|-- README.md
</code></pre>
<p>We have the following folders and files.</p>
<ul>
<li><em>starling_controller</em> will be populated by user created ros packages. Anything in this folder is directly  copied to the Dockerfile and built.</li>
<li><em>deployment</em> contains a sample docker-compose file which runs a default simulation stack, and a sample kubernetes file for deployment, both will most definitely need to be edited.</li>
<li><em>buildtools</em> contains the specification that docker uses to build the container. It contains the naming for the docker image.</li>
<li><em>Dockerfile</em> contains the dockerfile which specifies the build steps for this project. It already specifies the installation of a number of dependencies, including <a href="https://github.com/CD3/libInterpolate">libInterpolate</a> interpolation library.</li>
</ul>
<p>Once generated, the <em>Makefile</em> can be used to build and run commands:</p>
<pre><code class="language-sh">cd &lt;Your Application Name&gt; # Go into the your new Starling application directory
make # Will build the project
make run # Will build and run the container
make run_bash # Will build and run the container, putting you in a bash shell inside it.
make help # Shows the help screen
</code></pre>
<p>This should successfuly build your project container which you can try and run or inspect. Currently it has no funcionality so nothing can happen. Have a look inside the container using <code>make run_bash</code>.</p>
<blockquote>
<p><em>Note</em> On windows you can either use WSL or have a look at some of the solutions <a href="https://stackoverflow.com/questions/2532234/how-to-run-a-makefile-in-windows">in this link</a></p>
</blockquote>
<h2 id="adding-nodes-to-your-project"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.4</span> Adding Nodes to your project<a class="headerlink" href="#adding-nodes-to-your-project" title="Permanent link">¶</a></h2>
<p>The generated project has no functionality right now. This repository contains other templates which will generate rosnodes for you. In particular</p>
<ul>
<li><em>cpp_ros2_node_onboard_template</em>: Generates a ROS2 node, designed for running onboard the vehicle written in CPP.</li>
<li><em>python_ros2_node_offboard_template</em>: Generates a ROS2 node, designed for running offboard (central server) written in Python</li>
<li><em>ros2_msgs_template</em>: Generates a ROS2 msgs package which can be used by any ROS2 package within this container.</li>
</ul>
<p>These nodes can be added to your project using the following cookiecutter commands. Note that the packages should be generated into the <code>starling_project_name</code> directory of the base Starling project. Each of these commands are single line commands.</p>
<pre><code class="language-sh"># CPP Onboard
cookiecutter https://github.com/StarlingUAS/starling_controller_templates.git --directory cpp_ros2_node_onboard_template -o starling_controller/starling_controller
</code></pre>
<pre><code class="language-sh"># Python Offboard
cookiecutter https://github.com/StarlingUAS/starling_controller_templates.git --directory python_ros2_node_offboard_template -o starling_controller/starling_controller
</code></pre>
<pre><code class="language-sh"># Messages
cookiecutter https://github.com/StarlingUAS/starling_controller_templates.git --directory ros2_msgs_template -o starling_controller/starling_controller
</code></pre>
<blockquote>
<p><em>Note</em> the <code>--directory</code> option points cookiecutter to the correct template, the <code>-o</code> option specifies the output directory, in our case the output should be inside the created Starling project.</p>
</blockquote>
<p>Similar to the generating of the base project, these will ask a number of questions to you during the generation. In particular it will ask what the <code>package_name</code> is which will become the name of that particular node package.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>full_name</td>
<td>starling_user</td>
<td>Your name used for documentation</td>
</tr>
<tr>
<td>email</td>
<td>starling.user@starling.co.uk</td>
<td>Your email address used for documentaiton</td>
</tr>
<tr>
<td>year</td>
<td>2022</td>
<td>The year of creation for documentation</td>
</tr>
<tr>
<td>package_name</td>
<td>template_node</td>
<td>The name of this ROS2 Node, make sure this is correct and then you note it down. It should match the ones given in the initial Starling setup</td>
</tr>
<tr>
<td>short_description</td>
<td>ROS2 node template</td>
<td>A short description of the functionality of this node for documentation and project files</td>
</tr>
<tr>
<td>custom_ros2_msgs_name</td>
<td>template_msgs</td>
<td><strong>Important!</strong> The name of the custom msgs package name you have added as part of this starling project. The name must match exactly otherwise the default functionality will fail.</td>
</tr>
</tbody>
</table>
<blockquote>
<p><em>Note</em> convention for msg packages is to have a package name of format <code>&lt;mymessages&gt;_msgs</code>, e.g. <code>circle_experiment_msgs</code>.</p>
<p><em>Note</em> For those familiar with ROS1, it is ROS2 convention to keep messages in a seperate package to the ros nodes themselves.</p>
</blockquote>
<p>This should give you a file tree that looks something like the following (of course with your package names instead)</p>
<pre><code class="language-tree">starling_controller
|-- buildtools
    |-- docker-bake.hcl
|-- deployment
    |-- docker-compose.yml
    |-- kubernetes.yaml
|-- starling_controller
    |-- template_onboard_controller
        |-- ...
    |-- template_offboard_controller
        |-- ...
    |-- template_msgs
        |-- ...
    |-- run.sh
|-- Dockerfile
|-- LICENSE
|-- Makefile
|-- README.md
</code></pre>
<p>That being said, the nodes can be run standalone for your own projects, one at a time, or whenever you need a new node within your project.</p>
<p>Once these packages have been placed within the correct directory inside the Starling project, you can simply run <code>make</code> to check that they are successfully built.</p>
<h2 id="what-is-in-the-templates"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.5</span> What is in the templates<a class="headerlink" href="#what-is-in-the-templates" title="Permanent link">¶</a></h2>
<p>The set of node templates above should create you a project which runs the example scenario specifically developed for the purpose of this tutorial. This example has been designed to show the development of an onboard and an offboard container, as well as demonstratee communication between the two. The scenario is as follows:</p>
<ol>
<li>We have <span><span class="MathJax_Preview">\(n\)</span><script type="math/tex">n</script></span> drones which we would like to fly equidistant around a circle of fixed radius at a initial velocity.</li>
<li>A central server will send each drone an id <span><span class="MathJax_Preview">\(i&lt;n\)</span><script type="math/tex">i<n</script></span> to determine its start location around the circle.</li>
<li>Once received the drones will start flying around the circle and send its current position to the server.</li>
<li>The server collates the drones informations to determine if any of the drones are lagging or ahead of where they should be. This ideal position is sent back to each drone.</li>
<li>The drone adjusts its velocity to try based on the error to match with the ideal.</li>
</ol>
<p>With this in mind we can quickly run through what is in each of the ros node templates.</p>
<blockquote>
<p><em>Note:</em> More detail about the actual functionality within these nodes will be in <a href="../cpp_example_dev/">this tutorial section</a></p>
</blockquote>
<h3 id="cpp_ros2_node_onboard_template"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.5.1</span> <code>cpp_ros2_node_onboard_template</code><a class="headerlink" href="#cpp_ros2_node_onboard_template" title="Permanent link">¶</a></h3>
<pre><code class="language-tree">|-- CMakeLists.txt
|-- include
|   |-- controller.hpp
|   |-- main.hpp
|   `-- state.hpp
|-- launch
|   `-- template_cpp_node.launch.xml
|-- package.xml
`-- src
    |-- controller.cpp
    `-- main.cpp
</code></pre>
<p>This node runs onboard the vehicle and interfaces with MAVROS. It contains a state machine with functionality to arm, takeoff, land, loiter and takes care of safety functionality.</p>
<ul>
<li><code>CMakeLists.txt</code>: contains the instructions to build this rosnode. This includes specifying dependencies and extra libraries (e.g. messages such as <code>geometry_msgs</code> or external dependencies). It also specifies the name of the binary containing all of your functionality. By default this is <code>controller</code>.</li>
<li><code>include</code> and <code>src</code>: In CPP, your code files are split into header files (specifying object definitions) and source files (specifying object functionality), these are stored here</li>
<li><code>launch</code>: contains a ROS <code>launch</code> file. We use XML notation to describe how your rosnode gets launched, including extra parameters or other changes you want to make at runtime instead of buildtime. This is what gets run to run your rosnode</li>
<li><code>package.xml</code>: ROS2 Metadata file specifying ros2 dependencies of your project.</li>
</ul>
<p>As a brief overview of the code files:</p>
<ul>
<li><code>main.hpp</code> and <code>main.cpp</code>: Contains the program entrypoint function and the core of the ros node. It contains all of the core functionality to fly a vehicle as well as the state machine. It includes the user controller specified in <code>controller.hpp</code> to be expected to run during the <code>execution</code> phase of the state machine.</li>
<li><code>controller.hpp</code> and <code>controller.cpp</code>: For the majority of simple applications, a user should only need to provide their own version of these files. The controller contains an initialisation and loop function which a user can fill in.</li>
<li><code>state.hpp</code>: A header only file containing the states of the state machine.</li>
</ul>
<h3 id="python_ros2_node_offboard_template"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.5.2</span> <code>python_ros2_node_offboard_template</code><a class="headerlink" href="#python_ros2_node_offboard_template" title="Permanent link">¶</a></h3>
<pre><code class="language-tree">|-- package.xml
|-- resource
|   `-- template_python_node
|-- setup.cfg
|-- setup.py
|-- template_python_node
|   |-- __init__.py
|   `-- main.py
`-- test
    |-- test_copyright.py
    |-- test_flake8.py
    `-- test_pep257.py
</code></pre>
<p>This node runs offboard on the central server. It is designed to run on its own with no external dependence on anything outside of the application.</p>
<ul>
<li><code>package.xml</code>: ROS2 Metadata file specifying ros2 dependencies of your project.</li>
<li><code>resource</code>: A python ros package special folder, no need to touch</li>
<li><code>setup.cfg</code>: Configuration file specifying where key resources are</li>
<li><code>setup.py</code>: The python equivalent of <code>CMakeLists.txt</code> and contains the instructions to build this rosnode. It specifies which resources are copied over and available to the rosnode at runtime. Also specifies the name of the binary, and which function it is intended to run. By default this is <code>controller</code></li>
<li><code>&lt;your rosnode name&gt;</code> e.g. <code>template_python_node</code>: The source directory for your python files.</li>
<li><code>test</code>: A number of testing utilities which can be run with pytest. Currently not used.</li>
</ul>
<p>As a brief overview of code files:</p>
<ul>
<li><code>main.py</code>: Contains a ros node which uses a timer to repeat poll the current state of vehicles on the network at given intervals. It then performs the calculation of ideal vehicle location and sends that to the vehicles.</li>
</ul>
<h3 id="ros2_msgs_template"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.5.3</span> <code>ros2_msgs_template</code><a class="headerlink" href="#ros2_msgs_template" title="Permanent link">¶</a></h3>
<pre><code class="language-tree">|-- CMakeLists.txt
|-- msg
|   |-- NotifyVehicles.msg
|   `-- TargetAngle.msg
`-- package.xml
</code></pre>
<p>This node is purely for specifying and building the custom ros messages in our application. Any application which uses these messages need a compiled version of this node.</p>
<ul>
<li><code>CMakeLists.txt</code>: contains the instructions to build the messages. Any extra messages or services need to be added to the CMakeLists.</li>
<li><code>msg</code>: A list of specified custom messages.</li>
<li><code>package.xml</code>: ROS2 Metadata file specifying ros2 dependencies of your project.</li>
</ul>
<h3 id="dockerfile"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.5.4</span> Dockerfile<a class="headerlink" href="#dockerfile" title="Permanent link">¶</a></h3>
<p>As mentioned in the <a href="../docker/">previous tutorial</a>, a Dockerfile is used as a recipe to build your controller docker container.</p>
<p>The Dockerfile in this template contains the command line instructions to build your controller.</p>
<p>By default it will install a number of useful libraries for compatibility.</p>
<blockquote>
<p>If you need any new libraries, you will have to add their installation here</p>
</blockquote>
<p>It then essentially copies in all of the rosnodes specified within the project name directory and runs them through the standard ROS2 build tool named <code>colcon</code>.</p>
<p>It also copies over the <code>run.sh</code> file which the Dockerfile will run on container startup. Therefore the <code>run.sh</code> should have the instructions for running your applications.</p>
<p>Thankfully you do not need to run <code>docker build</code> automatically as we have setup a special build system which is wrapped up inside the <code>Makefile</code>.</p>
<h2 id="running-your-new-project"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.6</span> Running your new project<a class="headerlink" href="#running-your-new-project" title="Permanent link">¶</a></h2>
<p>With your project now constructed, you can now re-run your container with the same <code>make</code> commands as earlier.</p>
<pre><code class="language-sh">cd &lt;Your Application Name&gt; # Go into the your new Starling application directory
make run # Will build and run the container
</code></pre>
<blockquote>
<p>This will build a container called <code>&lt;Docker Username&gt;/&lt;Docker Image Name&gt;</code> with tag latest e.g. <code>myname/starling_template:latest</code></p>
</blockquote>
<p>This will build start the onboard controller by default, but it will start complaining that it hasn't received any state or position messages for initialisation. This is normal for now!</p>
<p>If you want to start the offboard controller, you can add the extra option <code>ENV="-e OFFBOARD=true"</code> to the make command like so <code>make run ENV="-e OFFBOARD=true"</code>. Where it will start trying to identify the number of vehicles on the network, but of course it cannot find any!</p>
<p>You can have a look inside both container using <code>make run_bash</code>.</p>
<h2 id="initialising-git"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.7</span> Initialising Git<a class="headerlink" href="#initialising-git" title="Permanent link">¶</a></h2>
<p>Optionally, at this point you can start version controller on your project in order to save your progress. To initalise git and create your first commit, go to the root of your project and run:</p>
<pre><code class="language-bash">git init
git add -A
git commit -m "Initial Commit"
</code></pre>
<p>If you want to push this code onto github, you can follow <a href="https://www.digitalocean.com/community/tutorials/how-to-push-an-existing-project-to-github">this tutorial</a>. In short, create an empty github repository of the same name in your github account, then change the remote locally:</p>
<pre><code class="language-bash">git remote add origin &lt;remote repository URL&gt;
git remote -v
git push origin master
</code></pre>
<h2 id="next-steps"><span class="enumerate-headings-plugin enumerate-heading-plugin">4.8</span> Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<p>Congratulations, you now have your own Starling application! It doesn't quite have any functionality just yet but before we get to adding some, it's important to understand how you run the simulation for you to test your controller against!</p>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="../simulation/" title="5. Simulation and the Digital Double">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="../docker/" title="3. Docker and Containerisation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
<p>Copyright © 2022 University of Bristol Flight Laboratory</p>
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/StarlingUAS/starling_controller_templates/tree/implement_example/" style="color: #fcfcfc"> GitHub</a>
</span>
<span><a href="../docker/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../simulation/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme_extra.js"></script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script defer="" src="../search/main.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
